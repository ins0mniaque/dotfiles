#!/bin/sh

onexit() {
    return
}

trap onexit 1 2 3 15 18 20 ERR

echo "Locked by $USER"

while true; do
    if [ $# -gt 0 ]; then
        sh -c "$@"
    else
        printf "\e[90mPress enter to unlock\e[0m"; read -s; printf "\r\033[K"
    fi

    sudo -kv

    if [ "$?" -eq 0 ]; then
        echo "Unlocked by $USER"
        exit 0
    fi
done